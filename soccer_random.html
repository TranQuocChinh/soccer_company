<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <title>ENJOYWORKS FC</title>
</head>
<style>
  @-webkit-keyframes my {
    0% {
      color: #F8CD0A;
    }

    50% {
      color: #fff;
    }

    100% {
      color: #F8CD0A;
    }
  }

  @-moz-keyframes my {
    0% {
      color: #F8CD0A;
    }

    50% {
      color: #fff;
    }

    100% {
      color: #F8CD0A;
    }
  }

  @-o-keyframes my {
    0% {
      color: #F8CD0A;
    }

    50% {
      color: #fff;
    }

    100% {
      color: #F8CD0A;
    }
  }

  @keyframes my {
    0% {
      color: #F8CD0A;
    }

    50% {
      color: #fff;
    }

    100% {
      color: #F8CD0A;
    }
  }

  .title {
    background: #38376c;
    font-size: 40px;
    font-weight: bold;
    -webkit-animation: my 700ms infinite;
    -moz-animation: my 700ms infinite;
    -o-animation: my 700ms infinite;
    animation: my 700ms infinite;
  }
  .result{
    background: #d45757;
    font-size: 40px;
    font-weight: bold;
    -webkit-animation: my 700ms infinite;
    -moz-animation: my 700ms infinite;
    -o-animation: my 700ms infinite;
    animation: my 700ms infinite;
  }
</style>

<body>
  <div class="container container border mt-5 pb-5">
    <div class="text-center mt-5 mb-5 title">
      <img src="https://hocwebgiare.com/images/Flame-rev.gif" width="15" height="17" alt="">
      ENJOYWORKS FC
      <img src="https://hocwebgiare.com/images/Flame-rev.gif" width="15" height="17" alt="">
    </div>
    <div class="row">
      <div class="col-4 text-center">
        <div class="row">
          <div class="col-8 ">
            <h4>Name register</h4>
          </div>
          <div class="col-4 ">
            <h4>Team</h4>
          </div>
        </div>

      </div>
      <div class="col-4">

      </div>
      <div class="col-4 text-center">
        <div class="row">
          <div class="col-8">
            <h4>Name register</h4>
          </div>
          <div class="col-4">
            <h4>Team</h4>
          </div>
        </div>
      </div>
    </div>
    <form action="" id="form">
      <div class="mt-2" id="js-content-team">
      </div>

      <div class="footer">
        <div class="row mt-1">
          <div class="col-4">
          </div>
          <div class="col-4">
            <button type="button" class="btn btn-sm btn-warning w-100 mt-1" id="js-btn-add">+</button>
          </div>
          <div class="col-4">
          </div>
        </div>

        <hr>
        <div class="mt-3" id="result">
          <div class="row">
            <div class="col-2"></div>
            <div class="col-8 text-center mt-5 mb-5 result">
              <img src="https://hocwebgiare.com/images/Flame-rev.gif" width="15" height="17" alt="">
                KẾT QUẢ
              <img src="https://hocwebgiare.com/images/Flame-rev.gif" width="15" height="17" alt="">
            </div>
            <div class="col-2"></div>

          </div>
          <div class="row d-flex align-items-center">
            <div class="col-3">
              <h2>Team 1 (<span id="qty-team-1"></span>):</h2>
            </div>
            <div class="col-9 text-left">
              <h2 id="team-1"></h2>
            </div>
          </div>
          <div class="row d-flex align-items-center">
            <div class="col-3">
              <h2>Team 2  (<span id="qty-team-2"></span>):</h2>
            </div>
            <div class="col-9 text-left">
              <h2 id="team-2"></h2>
            </div>
          </div>
        </div>
        <div class="row mt-5 text-center">
          <div class="col-6">
            <button type="button" class="btn btn-lg btn-success w-50 mt-1" id="btn-submit">Submit</button>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-lg btn-secondary w-50 mt-1" id="btn-reset">Reload</button>
          </div>
        </div>
      </div>
    </form>

  </div>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
  integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script>
  var id = 0;
  var result = [];
  var result1 = [];
  var result2 = [];
  var isvalid = false;
  var dataArr = [
    [{
        name: '',
        team: null
      },
      {
        name: '',
        team: null
      },
    ],
    [{
        name: '',
        team: null
      },
      {
        name: '',
        team: null
      },
    ],
    [{
        name: '',
        team: null
      },
      {
        name: '',
        team: null
      },
    ],
    [{
        name: '',
        team: null
      },
      {
        name: '',
        team: null
      },
    ],
    [{
        name: '',
        team: null
      },
      {
        name: '',
        team: null
      },
    ]
  ];

  $(document).ready(function () {
    renderItems(dataArr);
    $('#result').hide();

    $('#js-btn-add').on('click', function () {
      dataArr.push([{
          name: '',
          team: null
        },
        {
          name: '',
          team: null
        },
      ])

      renderItems(dataArr);
    })
  });

  function removeItem(idx) {
    if (dataArr.length > 5) {
      $(`#box-content-${id}`).remove();
      dataArr.splice(idx, 1);
      renderItems(dataArr);
    }
  }

  function validateInput(valName1, valName2, name1, name2, data) {

    let compareStr = valName1.localeCompare(valName2);

    if ((valName1 === '' && valName2 === '') || compareStr == 0) {
      $(name1).addClass('is-invalid');
      $(name2).addClass('is-invalid');
      isvalid = true;
    }else{
      $(name1).removeClass('is-invalid');
      $(name2).removeClass('is-invalid');
      isvalid = false;
    }

    return isvalid;
  }

  function randomItem(id) {
    $('#result').hide();
    let idRand = randomIntFromInterval(1, 2);
    let name1 = $(`input[name=${id}-name1]`);
    let valName1 = $(`input[name=${id}-name1]`).val();
    let name2 = $(`input[name=${id}-name2]`);
    let valName2 = $(`input[name=${id}-name2]`).val();
    let validate = validateInput(valName1, valName2, name1, name2, dataArr);
    dataArr.map((item, idx) => {
      if (id === idx) {
        dataArr[idx][0] = {
          ...dataArr[idx][0],
          name: valName1,
        }
        dataArr[idx][1] = {
          ...dataArr[idx][1],
          name: valName2,
        }
      }
    })
    if (!isvalid) {
      $(`#btn-random-${id}`).prop('disabled', true);
      $(`#loading-${id}`).css('display', 'inline-block');
      $('#js-btn-add').prop('disabled', true);
      $('#btn-submit').prop('disabled', true);
      setTimeout(() => {
        $(`#loading-${id}`).css('display', 'none');
        $('#js-btn-add').prop('disabled', false);
        $('#btn-submit').prop('disabled', false);
        name1.prop('readonly', true);
        name2.prop('readonly', true);
        dataArr.map((item, idx) => {
          if (id === idx) {
            dataArr[idx][0] = {
              name: valName1,
              team: idRand
            }
            dataArr[idx][1] = {
              name: valName2,
              team: idRand === 1 ? 2 : 1
            }
          }
        })
        $(`#js-team1-${id}`).val(idRand);
        $(`#js-team2-${id}`).val(idRand === 1 ? 2 : 1);
        
      }, 1500);
      
    } else {
      // $('#js-btn-add').prop('disabled', false);
    }
  }

  function renderItems(data) {
    if (data.length > 0) {
      let html = data.map(function (item, k) {
        return renderLines(item, k)
      });
      $('#js-content-team').html(html.join(''));
    }
  }
  
  const handleChange = (idx, name) => {
  //   let name1 = $(`input[name=${id}-name1]`);
  //   let valName1 = $(`input[name=${id}-name1]`).val();
  //   let name2 = $(`input[name=${id}-name2]`);
  //   let valName2 = $(`input[name=${id}-name2]`).val();
  //   console.log(valName1, idx);
  //   dataArr.map((item, idx) => {
  //     if (id === idx) {
  //       dataArr[idx][0] = {
  //         ...dataArr[idx][0],
  //         name: valName1,
  //       }
  //       dataArr[idx][1] = {
  //         ...dataArr[idx][1],
  //         name: valName2,
  //       }
  //     }
  //   })
  }

  const renderLines = (item, idx) => {
    return `
            <div class="row box-content mt-2" id="box-content-${idx}">
              <div class="col-4">
                <div class="row">
                  <div class="col-8">
                    <input type="text" class="form-control" name="${idx}-name1" value="${item[0].name}" data-id="${idx}" onkeyup="handleChange(${idx}, '${idx}-name1')" placeholder="Name" aria-label="Name" aria-describedby="basic-addon1">
                  </div>
                  <div class="col-4">
                    <input type="text" class="form-control" readonly name="${idx}-team1" value="${item[0].team ?? '' }" id="js-team1-${idx}" data-id="${idx}" aria-label="Name" aria-describedby="basic-addon1">
                  </div>
                </div>
                
              </div>
              <div class="col-4 text-center">
                <div class="row">
                  <div class="col-6">
                    <button class="btn btn-sm btn-primary w-100 mt-1 btn-random-item" ${(item[0]?.team !== null && item[1]?.team !== null) ? 'disabled' : ''} type="button" id="btn-random-${idx}" onclick="randomItem(${idx})">
                      <span class="spinner-grow spinner-grow-sm" id="loading-${idx}" style="display: none" role="status" aria-hidden="true"></span>
                      Random
                    </button>
                  </div>
                  <div class="col-6">
                    <button type="button" class="btn btn-sm btn-danger w-100 mt-1 btn-remove" onclick="removeItem(${idx})">-</button>
                  </div>
                </div>
              </div>
              <div class="col-4">
                <div class="row">
                  <div class="col-8">
                    <input type="text" class="form-control" name="${idx}-name2" value="${item[1].name}" data-id="${idx}" onkeyup="handleChange(${idx}, '${idx}-name2')" placeholder="Name" aria-label="Name" aria-describedby="basic-addon1">
                  </div>
                  <div class="col-4">
                    <input type="text" class="form-control" readonly  name="${idx}-team2" value="${item[1].team ?? ''}" id="js-team2-${idx}" data-id="${idx}" aria-label="Name" aria-describedby="basic-addon1">
                  </div>
                </div>
              </div>
            </div>
              `
  }


  function randomIntFromInterval(min, max) {
    return Math.floor(Math.random() * (max - min + 1) + min);
  }

  $('#btn-submit').on('click', function () {
    $('#result').show();
    let data = $('form').serializeArray();
    let arr = [];
    const chunkSize4 = 4;
    const chunkSize2 = 2;
    for (let i = 0; i < data.length; i += chunkSize4) {
      const chunk = data.slice(i, i + chunkSize4);
      for (let i = 0; i < chunk.length; i += chunkSize2) {
        const chunk2 = chunk.slice(i, i + chunkSize2);
        arr.push(chunk2);
      }
    }
    showResult(arr);
  })

  $('#btn-reset').on('click', function() {
    location.reload();
  })

  function showResult(data) {
    let arr1 = [];
    let arr2 = [];
    data.map((item, idx) => {
      if (item[1].value == 1 && item[0].value != '') {
        arr1.push(item[0].value)
      }
      if (item[1].value == 2 && item[0].value != '') {
        arr2.push(item[0].value)
      }
    })

    $('#qty-team-1').html(arr1.length);
    $('#qty-team-2').html(arr2.length);
    $('#team-1').html(arr1.join(" - "));
    $('#team-2').html(arr2.join(" - "));
  }
</script>
